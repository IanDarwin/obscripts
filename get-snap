#!/bin/sh -u

# get the current OpenBSD snapshot

REL=32				# "27" for OpenBSD 2.7, etc.
case "$REL" in
	2[0-6])	EXT=.tar.gz;;
	*)		EXT=.tgz;;
esac;
SITE=ftp.openbsd.org		# where to get it from, 1/4
SITE=ftp1.usa.openbsd.org		# where to get it from, 1/4
#SITE=ftp.darwinsys.com		# where to get it from, 1/4
PREFIX=pub			# 2/4
TOP=OpenBSD/snapshots		# 3/4
ARCH=i386			# 4/4
prog=ftp			# how to get it, changes to scp with -s
PROTO=ftp			# how $PROG is to get it, change to e.g http
VERBOSE=""			# how chattily to get it
BASEDIR=~ftp/pub/		# where to put it locally

USAGE="$0 [-s][-a arch ][-b local-Basedir][ -h hostabbrev|fqdn]
-a arch := i386|sparc|hppa|...
-v -- Verbose
"

function usage {		# give usage message, and exit
	echo "Usage: $USAGE" 2>&1
	exit 1
}

while getopts "a:b:h:p:sv" opt 
do 
 	 case "$opt" in 
		a)	ARCH=$OPTARG ;;
		b)	BASEDIR=$OPTARG ;;
		h)	
			case "$OPTARG" in
			geek*) SITE=ftp.geek-girl.com
					;;
			lager)	SITE=lager.cs.ualberta.ca
					;;
			*)		SITE=${OPTARG};;
			esac
			;;
		p)	PROTO=$optarg;;
		s)	prog=ssh;;
		v)	VERBOSE=v;;
		*)	usage;;
	esac
done
shift `expr $OPTIND - 1`		 # leave just filenames

DIR=${BASEDIR}/OpenBSD/${ARCH}
if [ ! -d ${DIR} ]; then
	mkdir ${DIR}
fi
cd ${DIR} || exit

#BSD
FILES1="MD5 INSTALL.${ARCH} floppy${REL}.fs base${REL}${EXT} etc${REL}${EXT} misc${REL}${EXT}"
FILES2="comp${REL}${EXT} game${REL}${EXT} ssl${REL}${EXT} man${REL}${EXT}"
XFILES="xbase${REL}${EXT} xfont${REL}${EXT} xserv${REL}${EXT} xshare${REL}${EXT}"

case ${ARCH} in
	i386)	FILES="$FILES1 floppy${REL}B.fs floppy${REL}C.fs $FILES2";;
	sparc)	FILES="$FILES1 miniroot${REL}.fs $FILES2";;
	*)	FILES="$FILES1 $FILES2";;
esac

if [ "" != "NO-X" ]; then
	FILES="$FILES $XFILES"
fi

if [ "" != "${VERBOSE}" ]; then
	set -x
fi

if [ $# -ne 0 ]; then
	usage
fi

case ${prog} in
ftp)
	for f in ${FILES}
	do
		CMD="ftp ${PROTO}://${SITE}/${PREFIX}/${TOP}/${ARCH}/${f}"
		echo "--> $CMD"
		$CMD
	done
	;;
ssh)
	scp -r ian@${SITE}:~ftp/${PREFIX}/${TOP}/${ARCH}/ .
	;;
esac
