#!/bin/sh

# quickupdate -- quickly update base files from snapshot

REL=28				# "26" for OpenBSD 2.6, etc.
RELDIR=2.8			# same but with a dot
case ${REL} in
	2[0-6])		EXT=tar.gz;;
	2[789]|3*)	EXT=tgz;;
esac

#ARCH=sparc
ARCH=i386

if [ -d /usr/download/OpenBSD/${RELDIR}/${ARCH} ]; then
	 cd /usr/download/OpenBSD/${RELDIR}/${ARCH} || exit
elif [ -d /ftp/pub/OpenBSD/${RELDIR}/${ARCH} ]; then
	 cd /ftp/pub/OpenBSD/${RELDIR}/${ARCH} || exit
fi

DEST=/
#DEST=/export/dartboard/root

# NEVER include etc in this list, or you will die horribly!
BDIRS="base comp misc man"
XDIRS="xbase xfont xserv xshare"

DIRS="${BDIRS}"
#DIRS="${BDIRS} ${XDIRS}"
#DIRS="${XDIRS}"

for f in ${DIRS}
do
	FILE="${f}${REL}.${EXT}"
	if [ -f ${FILE} ]; then
		echo "===> $f (${FILE})"
	else
		echo "Cannot locate file ${FILE}"
		exit
	fi
	(cd ${DEST} || exit; sudo tar xvzpf - ) < ${FILE}
done

if [ -f bsd ]; then
	cp bsd ${DEST}/nbsd

	cd ${DEST}
	if [ -f bsd -a -f nbsd ]; then
		mv bsd obsd
		mv nbsd bsd
	fi
fi

echo "*** REMEMBER TO RUN POSTUPGRADE ***"
